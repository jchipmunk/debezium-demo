# debezium-demo

## Prepare Docker images




```
GIDOLR=54321
UIDOLR=54321
GIDORA=54322
```





## Prepare database tables

```sql
CREATE TABLE c##dbzuser.source_data_types (
  id                       NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY (START with 1 INCREMENT by 1) NOT NULL PRIMARY KEY,
  c_varchar2               VARCHAR2(400),
  c_nvarchar2              NVARCHAR2(400),
  c_number                 NUMBER(20),
  c_float                  FLOAT(63),
  c_decimal                DECIMAL(16),
  c_long                   LONG,
  c_binary_float           BINARY_FLOAT,
  c_binary_double          BINARY_DOUBLE,
  c_date                   DATE,
  c_timestamp              TIMESTAMP,
  c_timestamp_wtz          TIMESTAMP WITH TIME ZONE,
  c_timestamp_wltz         TIMESTAMP WITH LOCAL TIME ZONE,
  c_raw                    RAW(1000),
  c_char                   CHAR(100),
  c_nchar                  NCHAR(100),
  c_clob                   CLOB,
  c_nclob                  NCLOB,
  c_blob                   BLOB
);

GRANT SELECT ON c##dbzuser.source_data_types TO c##dbzuser;
ALTER TABLE c##dbzuser.source_data_types ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;

INSERT INTO c##dbzuser.source_data_types (
  c_varchar2,
  c_nvarchar2,
  c_number,
  c_float,
  c_decimal,
  c_long,
  c_binary_float,
  c_binary_double,
  c_date,
  c_timestamp,
  c_timestamp_wtz,
  c_timestamp_wltz,
  c_raw,
  c_char,
  c_nchar,
  c_clob,
  c_nclob,
  c_blob
)
VALUES (
  'varchar2',
  'nvarchar2',
  1,
  12.12,
  123.123,
  1234,
  1.234567E+003,
  1.234567E+003,
  TO_DATE('2019-01-30 18:30:52', 'YYYY-MM-DD HH24:MI:SS'),
  TO_TIMESTAMP('2019-01-30 18:30:52.123000','YYYY-MM-DD HH24:MI:SS.FF'),
  TO_TIMESTAMP_TZ('2019-01-30 18:30:52.123000 -08:00','YYYY-MM-DD HH24:MI:SS.FF TZH:TZM'),
  TO_TIMESTAMP('2019-01-30 18:30:52.123000','YYYY-MM-DD HH24:MI:SS.FF'),
  HEXTORAW('7D'),
  'char',
  'nchar',
  TO_CLOB('clob'),
  TO_NCLOB('nclob'),
  TO_BLOB(HEXTORAW('7D'))
);

INSERT INTO c##dbzuser.source_data_types (
  c_varchar2,
  c_nvarchar2,
  c_number,
  c_float,
  c_decimal,
  c_long,
  c_binary_float,
  c_binary_double,
  c_date,
  c_timestamp,
  c_timestamp_wtz,
  c_timestamp_wltz,
  c_raw,
  c_char,
  c_nchar,
  c_clob,
  c_nclob,
  c_blob
)
VALUES (
  'varchar2',
  'nvarchar2',
  1,
  12.12,
  123.123,
  1234,
  1.234567E+003,
  1.234567E+003,
  TO_DATE('2019-01-30 18:30:52', 'YYYY-MM-DD HH24:MI:SS'),
  TO_TIMESTAMP('2019-01-30 18:30:52.123000','YYYY-MM-DD HH24:MI:SS.FF'),
  TO_TIMESTAMP_TZ('2019-01-30 18:30:52.123000 -08:00','YYYY-MM-DD HH24:MI:SS.FF TZH:TZM'),
  TO_TIMESTAMP('2019-01-30 18:30:52.123000','YYYY-MM-DD HH24:MI:SS.FF'),
  HEXTORAW('7D'),
  'char',
  'nchar',
  TO_CLOB('clobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclobclob'),
  TO_NCLOB('nclob'),
  TO_BLOB(HEXTORAW('7D'))
);

UPDATE c##dbzuser.source_data_types
SET c_date = TO_DATE('2019-01-30 18:31:52', 'YYYY-MM-DD HH24:MI:SS')
WHERE c_date = TO_DATE('2019-01-30 18:30:52', 'YYYY-MM-DD HH24:MI:SS');
```

```sql
CREATE TABLE c##dbzuser.sink_data_types (
  id                       NUMBER(10) NOT NULL PRIMARY KEY,
  c_varchar2               VARCHAR2(400),
  c_nvarchar2              NVARCHAR2(400),
  c_number                 NUMBER(20),
  c_float                  FLOAT(63),
  c_decimal                DECIMAL(16),
  c_long                   LONG,
  c_binary_float           BINARY_FLOAT,
  c_binary_double          BINARY_DOUBLE,
  c_date                   DATE,
  c_timestamp              TIMESTAMP,
  c_timestamp_wtz          TIMESTAMP WITH TIME ZONE,
  c_timestamp_wltz         TIMESTAMP WITH LOCAL TIME ZONE,
  c_raw                    RAW(1000),
  c_char                   CHAR(100),
  c_nchar                  NCHAR(100),
  c_clob                   CLOB,
  c_nclob                  NCLOB,
  c_blob                   BLOB
);
```

## Configure connectors

```bash
curl -X POST -H "Accept:application/json" -H "Content-Type:application/json" http://localhost:8083/connectors -d '
{
  "name": "source-data-types-logminer-connector",
  "config": {
    "connector.class": "io.debezium.connector.oracle.OracleConnector",
    "tasks.max": "1",
    "database.hostname": "oracle",
    "database.port": "1521",
    "database.user": "c##dbzuser",
    "database.password": "dbz",
    "database.dbname": "orclcdb",
    "database.pdb.name": "orclpdb1",
    "database.connection.adapter": "logminer",
    "topic.prefix": "logminer",
    "lob.enabled": "true",
    "schema.name.adjustment.mode": "avro",
    "table.include.list": "C##DBZUSER.SOURCE_DATA_TYPES",
    "include.schema.changes": "false",
    "schema.history.internal.kafka.bootstrap.servers" : "kafka:9092",
    "schema.history.internal.kafka.topic": "schema-changes.data-types-logminer",
    "heartbeat.interval.ms": "60000",
    "log.mining.strategy": "online_catalog",
    "log.mining.query.filter.mode": "in",
    "custom.metric.tags": "connector=source-data-types-connector",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "true",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter.schemas.enable": "true"
  }
}'
```

```bash
curl -X POST -H "Accept:application/json" -H "Content-Type:application/json" http://localhost:8083/connectors -d '
{
  "name": "source-data-types-olr-connector",
  "config": {
    "connector.class": "io.debezium.connector.oracle.OracleConnector",
    "tasks.max": "1",
    "database.hostname": "oracle",
    "database.port": "1521",
    "database.user": "c##dbzuser",
    "database.password": "dbz",
    "database.dbname": "orclcdb",
    "database.pdb.name": "orclpdb1",
    "database.connection.adapter": "olr",
    "openlogreplicator.source": "ORACLE",
    "openlogreplicator.host": "olr",
    "openlogreplicator.port": "9000",
    "topic.prefix": "olr",
    "lob.enabled": "true",
    "schema.name.adjustment.mode": "avro",
    "table.include.list": "C##DBZUSER.SOURCE_DATA_TYPES",
    "include.schema.changes": "false",
    "schema.history.internal.kafka.bootstrap.servers" : "kafka:9092",
    "schema.history.internal.kafka.topic": "schema-changes.data-types-olr",
    "heartbeat.interval.ms": "60000",
    "custom.metric.tags": "connector=source-data-types-connector",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "true",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter.schemas.enable": "true"
  }
}'
```

```bash
curl -X POST -H "Accept:application/json" -H "Content-Type:application/json" http://localhost:8083/connectors -d '
{
  "name": "sink-data-types-logminer-connector",
  "config": {
    "connector.class": "io.debezium.connector.jdbc.JdbcSinkConnector",
    "tasks.max": "1",
    "connection.url": "jdbc:oracle:thin:@oracle:1521/orclpdb1",
    "connection.username": "c##dbzuser",
    "connection.password": "dbz",
    "topics": "logminer.C__DBZUSER.SOURCE_DATA_TYPES",
    "insert.mode": "upsert",
    "delete.enabled": "true",
    "primary.key.mode": "record_key",
    "table.name.format": "c##dbzuser.SINK_DATA_TYPES",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "true",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter.schemas.enable": "true"
  }
}'
```

```bash
curl -X POST -H "Accept:application/json" -H "Content-Type:application/json" http://localhost:8083/connectors -d '
{
  "name": "sink-data-types-olr-connector",
  "config": {
    "connector.class": "io.debezium.connector.jdbc.JdbcSinkConnector",
    "tasks.max": "1",
    "connection.url": "jdbc:oracle:thin:@oracle:1521/orclpdb1",
    "connection.username": "c##dbzuser",
    "connection.password": "dbz",
    "topics": "olr.C__DBZUSER.SOURCE_DATA_TYPES",
    "insert.mode": "upsert",
    "delete.enabled": "true",
    "primary.key.mode": "record_key",
    "table.name.format": "c##dbzuser.SINK_DATA_TYPES",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "true",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter.schemas.enable": "true"
  }
}'
```
